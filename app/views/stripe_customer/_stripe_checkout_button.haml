%form{action: :save_card_details, method: :post}
  %input#stripe_button{:type => "submit", 
                      :value => "Enter Card Details", 
                      "data-description" => "", 
                      "data-key" => "#{Rails.configuration.stripe[:publishable_key]}", 
                      "data-name" => "SandboxApp", 
                      "data-email" => "#{@customer.email}", 
                      "data-panel-label" => "Save Card Details", 
                      "data-allow-remember-me" => 'false', 
                      "data-locale" => "auto"}

  %script{src: "https://checkout.stripe.com/v2/checkout.js"}
  :javascript
    $('#stripe_button').on('click', function(event) {
      event.preventDefault();
      var $button = $(this);
      $form = $button.parents('form');
      var opts = $.extend({}, $button.data(), {
        token: function(result) {
          $form.append($('<input>').attr({ type: 'hidden', name: 'stripeToken', value: result.id })).submit();
        }
      });
      StripeCheckout.open(opts);
    });
